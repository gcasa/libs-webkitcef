#!/bin/sh

if
    test -e cef_build
then
    echo "Build exists"
else
    echo "Downloading"
    ./bin/download_cef.sh
fi

BASE="cef_build/cef-project/third_party/cef"
PROJNAME=`ls -C1 ${BASE} | grep -v tar`
PROJDIR="${BASE}/${PROJNAME}"
LIBDIR="cef_build/cef-project/build/libcef_dll_wrapper"
SODIR="cef_build/cef-project/build/third_party/cef/${PROJNAME}/tests/cefsimple/Release"

echo "# Generated by build.sh, do not change" > GNUmakefile.generated
echo "\n" >> GNUmakefile.generated
echo "ADDITIONAL_INCLUDE_DIRS += -I${PROJDIR}/include/wrapper" >> GNUmakefile.generated
echo "ADDITIONAL_INCLUDE_DIRS += -I${PROJDIR}/include/capi" >> GNUmakefile.generated
echo "ADDITIONAL_INCLUDE_DIRS += -I${PROJDIR}/include" >> GNUmakefile.generated
echo "ADDITIONAL_INCLUDE_DIRS += -I${PROJDIR}" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -Wl,--whole-archive ${LIBDIR}/libcef_dll_wrapper.a -Wl,--no-whole-archive" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -Wl,--whole-archive ${SODIR}/libcef.so -Wl,--no-whole-archive" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -Wl,--whole-archive ${SODIR}/libEGL.so -Wl,--no-whole-archive" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -Wl,--whole-archive ${SODIR}/libGLESv2.so -Wl,--no-whole-archive" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -Wl,--whole-archive ${SODIR}/libvk_swiftshader.so -Wl,--no-whole-archive" >> GNUmakefile.generated
echo "ADDITIONAL_LDFLAGS += -L${LIBDIR}" >> GNUmakefile.generated
echo "\n" >> GNUmakefile.generated
echo "# Done" >> GNUmakefile.generated

# echo "ADDITIONAL_GUI_LIBS += -lcef_dll_wrapper" >> GNUmakefile.generated
make debug=yes

exit 0
